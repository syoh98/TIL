## ✏️ 설정해야 하는 대상
* 웹 기반의 시스템에서 성능에 영향을 줄만한 세팅
  * 웹 서버 세팅
  * WAS 서버 세팅
  * DB 서버 세팅
  * 장비 세팅
</br>

## ✏️ 아파치 웹 서버의 설정
* 아파치 웹 서버에서 성능에 영향을 줄 수 있는 세팅
  * httpd.conf 파일
    * ThreadsPerChild: 웹 서버가 사용하는 스레드의 개수를 지정한다. 이 수치를 늘려주면 서버가 더 많은 사용자의 요청을 처리할 수 있게 된다.
    * MaxRequestsPerChild: 최대 요청 개수를 지정하는 부분. 0이면 그 수에 제한을 두지 않겠다는 의미이고 10이면 그 이상의 처리는 하지 않게 된다.
  * `httpd-mpm.conf` 파일
    * StartServers: 서버를 띄울 때 프로세스의 개수를 지정한다.
    * MaxClients: 최대 처리 가능한 클라이언트의 수를 지정한다.
    * MinSpareThreads: 최소 여유 스레드 수를 지정한다.
    * MaxSpareThreads: 최대 여유 스레드 수를 지정한다.
    * ThreadsPerChild: 프로세스당 스레드 수를 지정한다.
    * MaxRequestsPerChild: MaxRequestsPerChild와 같은 의미이다.
</br>

## ✏️ 웹 서버의 Keep Alive
* 아파치 웹 서버의 경우 `httd.conf` 파일에 Keep Alive 설정이 ON 되어 있지 않으면, 매번 HTTP 연결을 맺었다 끊었다 하는 작업을 반복한다.
* 초기 화면이 매우 간단한 구글과 같은 사이트는 해당 사이트에 연결할 때 KeepAlive가 적용되지 않더라도 그리 느리지 않을 것이다.
* 네이버나 다음과 같이 초기 화면에서 엄청나게 많은 이미지와 CSS, 자바 스크립트 등의 파일을 받아야 하는 사이트에서 KeepAlive 옵션이 적용되어 있지 않다면, 초기화면을 띄우는 데 몇 분씩 소요될지도 모른다.
  * 즉, 이미지와 같은 모든 개체들도 서버에 매번 접속을 해야 하는 상황이 발생한다.
* **💡 `KeepAlive On`을 하면 두 개 정도의 연결을 열어서 끊지않고, 연결을 계속 재사용한다.**
* **➡️ 연결을 하기 위한 대기 시간이 짧아지기 때문에 사용자가 느끼는 응답속도도 엄청나게 빨라진다.**
* 💡 사용자의 접근이 많은 사이트에서는 이미지나 CSS와 같이 정적인 파일들을 일반적인 웹 서버에서 처리하지 않고, CDN(Content Delivery Network)이라고 하는 서비스를 사용한다.
  * 즉, 별도의 URL에서 해당 컨텐츠들을 내려받도록 설정하고, 동적인 컨텐츠들은 WAS에서 처리하도록 해놓으면 Web-WAS 서버의 부담도 줄어들게 된다.
* `KeepAlive-Timeout`: 초 단위로 KeepAlive가 끊기는 시간을 설정하기 위한 부분. 마지막 연결이 끝난 이후에 다음 연결이 될 때까지 얼마나 기다릴지 지정한다.
  * 사용자가 너무 많아 접속이 잘 안될 경우, 이 설정 값을 줄이는 것도 서버의 리소스를 보다 효율적으로 사용할 수 있는 방법이다.
</br>

## ✏️ DB Connection Pool 및 스레드 개수 설정
* DB Connection Pool
* 스레드 개수   
는 많이 사용할수록 메모리를 많이 점유하게 된다.   
그렇다고 메모리를 위해서 DB Connection Pool과 스레드 개수를 적게 지정하면, 서버에서는 많은 요청을 처리하지 못하고 대기할 수 밖에 없다.
* 대부분의 WAS에서는 DB Connection Pool의 개수를 최소치, 증가치, 최대치 등으로 자세하게 지정할 수 있다.
  * 최소치: 서버가 기동될 때 연결을 수행하는 개수
  * **최소 개수가 많을수록 서버 기동하는 시간이 오래 소요된다**
  * 최소치는 개발 중일 때는 최소한으로, 운영 중일 때는 최소 및 최대 값을 동일하게 하는 것이 좋다.
    * 사용자 수가 갑자기 증가하면 DB Connection Pool의 개수도 증가되어야 하고, 증가할 때 대기 시간이 발생할 확률이 크기 때문이다.
</br>

## ✏️ WAS 인스턴스 개수 설정
* 서버의 WAS 인스턴스 개수를 늘릴수록 CPU가 처리해야하는 양이 많아진다.
* 보통은 1~2개의 CPU당 하나의 인스턴스를 지정하는 것이 좋다고 얘기한다. 하지만, 장비 하나당 인스턴스 개수를 성능 테스트를 통해서 구하는 것이 가장 바람직하다.
 * 예를 들어
   * CPU core 개수가 36개 인 장비가 있을 경우, 인스턴스가 1개일 때 500 TPS/2개일 때 700 TPS/3개일 때 720 TPS/4개 일 때 730 TPS
     * ➡️ 인스턴스를 더 늘린다고 해서 TPS가 증가하지 않는 상황이다
     * ➡️ 이런 경우, 유지보수성이 떨어진다.
* 추가적으로 만약 WAS 장비에 4GB의 여유 메모리가 있다고 하더라도 하나의 인스턴스에 4GB의 메모리를 지정하려 사용하는 것은 좋지 못하다
  * ➡️Full GC가 발생할 때마다 많은 시간이 소요될 확률이 커지기 때문이다.
  * DB Connection Pool의 개수를 기준으로 적절한 수치를 찾는 방법을 생각해보자 
    * CASE 1)
      * DB Connection Pool을 40개로 잡아놓았다고 가정. 🤔 40개를 전부 사용하면서 DB의 CPU 사용량이 100%에 도달했다면, 어떻게 해야할까?
        * **이 경우에는 DB의 CPU를 점유하는 쿼리를 찾아서 튜닝을 수행해야 한다.**
        * 즉, 인덱스가 없거나 테이블을 풀 스캔하는 쿼리가 있는 것은 아닌지 쿼리의 플랜을 떠서 확인해 봐야한다.
    * CASE 2)
      * DB의 CPU 사용량을 50%도 되지 않는 상황에서 WAS의 CPU 사용량이 100%에 도달하고 있는 상황
      * 🤔 그 때 사용하는 DB Connection Pool의 개수는 20개 정도 밖에 되지 않는다. 이럴 때 어떻게 해야할까?
      * **이 경우에는 WAS의 애플리케이션을 튜닝해야 한다.**
* ➕) Connection Pool의 개수만큼 중요한 값, **대기시간(wait time)**
  * DB Connection Pool의 개수를 넘어섰을 때 애플리케이션에서 '어디 남는 Connection 없나?'하고 두리번 거리면서 기다린다   
    * ➡️ 이게 대기 시간이다.
    * ➡️ 이것 또한 시스템의 상황에 맞게 설정해야한다.
</br>

## ✏️ Session Timeout
* 가장 간과하기 쉬운 것이 세션의 종료 시간 설정 부분이다.
* 이 설정은 WAS에 종속적인 설정이 아닌 WEB-INF 폴더 하단의 web.xml 파일에서 설정하며 서블릿 스펙에 정의된 표준 설정 값이다.
* 세션 종료 시간 설정 값은 분 단위이다. 설정되어 있는 분만큼 요청이 없으면 세션을 메모리에서 제거한다.
* 이 설정을 하지 않은 상태에서, WAS에서 따로 설정한 바가 없거나 세션 객체의 invalidate() 메서드가 수행되지 않으면 세션은 삭제되지 않는다.
