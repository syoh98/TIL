## ✅ 4.1 좋은 단위 테스트의 4대 요소 자세히 살펴보기
* **첫 번째 요소: 회귀 방지**
  * 회귀는 소프트웨어 버그다. 코드를 수정한 후 기능이 의도한 대로 작동하지 않는 경우다.
  * 회귀 방지 지표를 극대화하려면 테스트가 가능한 한 많은 코드를 실행하는 것을 목표로 해야 한다.
* **두 번째 요소: 리팩터링 내성**
  * 리팩터링 내성은 테스트를 '빨간색'으로 바꾸지 않고 기본 애플리케이션 코드를 리팩터링할 수 있는지에 대한 척도다.
  * 리팩터링의 의도는 코드의 비기능적 특징을 개선하는 것으로 가독성을 높이고 복잡도를 낮추는 것이다.
  * 리팩터링 내성 지표에서 테스트 점수가 얼마나 잘 나오는지 평가하려면 테스트에서 얼마나 많이 거짓 양성이 발생하는지 살펴봐야 한다. 적을수록 좋다.
* **무엇이 거짓 양성의 원인인가?**
  * 테스트와 테스트 대상 시스템(SUT)의 구현 세부 사항이 많이 결합할수록 허위 경보가 더 많이 생긴다.
  * 거짓 양성이 생길 가능성을 줄이는 방법은 해당 구현 세부 사항에서 테스트를 분리하는 것뿐이다.
  * SUT의 구현 세부 사항과 결합된 테스트는 리팩터링 내성이 없다.
* **구현 세부 사항 대신 최종 결과를 목표로 하기**
  * 테스트를 깨지지 않게 하고 리팩터링 내성을 높이는 방법은 SUT의 구현 세부 사항과 테스트 간의 결합도를 낮추는 것뿐이다. 즉, 코드의 내부 작업과 테스트 사이를 가능한 한 멀리 떨어뜨리고 최종 결과를 목표로 하는 것이다.

## ✅ 4.2 첫 번째 특성과 두 번째 특성 간의 본질적인 관계
프로젝트가 시작된 직후에는 회귀 방지를 훌륭히 갖추는 것이 중요한 데 반해, 리팩터링 내성은 바로 필요하지 않다.
* **테스트 정확도 극대화**
  * 회귀 방지와 리팩터링 내성은 테스트 스위트의 정확도를 극대화하는 것을 목표로 한다.
  * 정확도 지표는 다음 두 가지 요소로 구성된다.
    * 테스트가 버그 있음을 얼마나 잘 나타내는가(거짓 음성(회귀 방지 영역) 제외)
    * 테스트가 버그 없음을 얼마나 잘 나타내는가(거짓 양성(리팩터링 내성 영역) 제외)
  * 테스트 정확도를 향상시키는 방법
    * 분자, 즉 신호를 증가시키는 것 -> 회귀를 더 잘 찾아내는 테스트로 개선하는 것
    * 분모, 즉 소음을 줄이는 것 -> 허위 경보를 발생시키지 않는 테스트로 개선하는 것
* **거짓 양성과 거짓 음성의 중요성: 역학 관계**
  * 프로젝트가 성장함에 따라 거짓 양성(허위 경부)은 테스트 스위트에 점점 큰 영향을 미친다.
  * 초기에는 왜 거짓 양성(허위 경보)이 중요하지 않은가? 리팩터링은 바로 중요하지는 않으며, 시간이 지나면서 점차 중요해진다.
  * 프로젝트 초기에는 코드 정리를 많이 할 필요가 없고, 개발자의 기억 속에 아직 생생하기 때문에 잘못된 경보가 발생해도 쉽게 리팩터링을 할 수 있다.
  * 그러나 시간이 프를수록 코드베이스는 나빠진다. 점점 복잡해지고 체계적이지 않게 된다. 따라서 이러한 경량을 줄이려면 정기적으로 리팩터링을 해야 한다.

## ✅ 4.3 세 번째 요소와 네 번째 요소: 빠른 피드백과 유지 보수성
* 빠른 피드백
  * 테스트가 빠르게 실행되면 코드에 결함이 생기자마자 버그에 대해 경고하기 시작할 정도로 피드백 루프를 대폭 줄여서, 버그를 수정하는 비용을 거의 0까지 줄일 수 있다.
  * 반면 느린 테스트는 피드백을 느리게 하고 잠재적으로 버그를 뒤늦게 눈에 띄게 해서 버그 수정 비용이 증가한다.
* 유지 보수성
  * 테스트가 얼마나 이해하기 어려운가
  * 테스트가 얼마나 실행하기 어려운가

## ✅ 4.4 이상적인 테스트를 찾아서 
* **이상적인 테스트를 만들 수 있는가?**
  * 이상적인 테스트는 회귀 방지, 리팩터링 내성, 빠른 피드백, 유지 보수성 이 네 가지 특성 모두에서 최대 점수를 받는 테스트다.
  * 그런 이상적인 테스트를 만드는 것은 불가능하다. 처음 세 가지 특성인 회귀 방지, 리팩터링 내성, 빠른 피드백은 상호 배타적이기 때문이다. 셋 중 하나를 희생해야 나머지 둘을 최대로 할 수 있다.
* **극단적인 사례 1: 엔드 투 엔드 테스트**
  * 엔드 투 엔드 테스트는 많은 코드를 테스트하므로 회귀 방지를 훌륭히 해낸다.
  * 또한 엔드 투 엔드 테스트는 거짓 양성에 면역이 돼 리팩터링 내성도 우수하다. 리팩터링은 (올바르게 했다면) 식별할 수 있는 동작을 변경하지 않으므로 엔드 투 엔드 테스트에 영향을 미치지 않는다.
  * 그러나 엔드 투 엔드 테스트는 속도가 느리다는 단점이 존재한다.
* **극단적인 사례 2: 간단한 테스트**
  * 간단한 테스트는 매우 빠르게 실행되고 빠른 피드백을 제공한다. 또한 거짓 양성이 생길 가능성이 상당히 낮기 때문에 리팩터링 내성도 우수하다.
  * 그러나 기반 코드에 실수할 여지가 많지 않기 때문에 간단한 테스트는 회귀를 나타내지 않을 것이다.
* **극단적인 사례 3: 깨지기 쉬운 테스트**
  * 깨지기 쉬운 테스트는 실행이 빠르고 회귀를 잡을 가능성이 높지만 거짓 양성이 많은 테스트를 의미한다.
  * 이는 리팩터링을 견디지 못하고, 해당 기능이 고장 났는지 여부와 관계없이 빨간색으로 바뀐다.
* **이상적인 테스트를 찾아서: 결론**
  * 좋은 단위 테스트의 세 가지 특성(회귀 방지, 리팩터링 내성, 빠른 피드백)은 상호 배타적이다. 이 세 가지 특성 중 두 가지를 극대화하는 테스트를 만들기는 매우 쉽지만, 나머지 특성 한 가지를 희생해야만 가능하다.
  * 안타깝게도 세 가지 특성 모두 완벽한 점수를 얻어서 이상적인 테스트를 만드는 것은 불가능하다.

## ✅ 4.5 대중적인 테스트 자동화 개념 살펴보기
* 테스트 피라미드 분해
  * 테스트 피라미드는 테스트 스위트에서 테스트 유형 간의 일정한 비율을 일컫는 개념이다.
    * 단위 테스트
    * 통합 테스트
    * 엔드 투 엔드 테스트
* 블랙박스 테스트와 화이트 테스트 간의 선택
  * 블랙박스 테스트: 시스템의 내부 구조를 몰라도 시스템의 기능을 검사할 수 있는 소프트웨어 테스트 방법이다.
  * 화이트박스 테스트: 애플리케이션의 내부 작업을 검증하는 테스트 방식
  * 화이트 박스 테스트 -> 회귀 방지: 좋음, 리팩터링 내성: 나쁨
  * 블랙박스 테스트 -> 회귀 방지: 나쁨, 리팩터링 내성: 좋음

## ✅ 요약
* 좋은 단위 테스트에는 단위 테스트, 통합 테스트, 엔드 투 엔드 테스트 등 자동화된 테스트를 분석하는 데 사용할 수 있는 네 가지 기본 특성이 있다.
  * 회귀 방지
  * 리팩터링 내성
  * 빠른 피드백
  * 유지 보수성
* 회귀 방지는 테스트가 얼마나 버그(회귀)의 존재를 잘 나타내는지에 대한 척도다. 테스트가 코드를 더 많이 실행할수록 테스트에서 버그가 드러날 확률이 더 높아진다.
* 리팩터링 내성은 테스트가 거짓 양성을 내지 않고 애플리케이션 코드 리팩터링을 유지할 수 있는 정도를 의미한다.
* 거짓 양성은 허위 경보다. 즉, 테스트가 실패했다고 나타내지만 그 기능은 의도한대로 작동한다. 거짓 양성은 테스트 스위트에 치명적인 영향을 줄 수 있다.
* 거짓 양성은 테스트 대상 시스템의 내부 구현 세부 사항과 테스트 간의 강결합의 결과다.
* 회귀 방지와 리팩터링 내성은 테스트 정확도에 기여한다.
* 거짓 양성은 프로젝트 초기에 부정적인 영향을 미치지는 않지만 프로젝트가 성장함에 따라 점점 더 중요해진다. 즉, 거짓 음성만큼 중요하다.
* 빠른 피드백은 테스트가 얼마나 빨리 실행되는지에 대한 척도다.
* 유지 보수성은 두 가지 요소로 구성된다. 테스트 이해 난이도, 테스트 실행 난이도
* 테스트의 가치 추정치는 네 가지 특성 각각에서 얻은 점수의 곱이다. 따라서 특성 중 하나라도 0이면, 테스트 가치도 0이 된다.
* 처음 세 가지 특성(회귀 방지, 리팩터링 내성, 빠른 피드백)은 상호 배타적이기 때문에 네 가지 특성 모두 최대 점수를 받는 것은 불가능하다.
* 리팩터링 내성은 타협할 수 없다.
* 테스트 피라미드는 단위 테스트, 통합 테스트, 엔드 투 엔드 테스트의 일정한 비율을 일컫는다. 엔드 투 엔드 테스트가 가장 적고, 단위 테스트가 가장 많으며, 통합 테스트는 그 중간 정도라 할 수 있다.
* 피라미드에서는 테스트 유형마다 빠른 피드백과 회귀 방지 사이에서 다른 선택을 한다. 엔드 투 엔드 테스트는 회귀 방지를 선호하는 데 반해, 단위 테스트는 빠른 피드백을 선호한다.
* 테스트를 작성할 때는 블랙박스 테스트 방법을 사용하라. 테스트를 분석할 때는 화이트박스 방법을 사용하라.
