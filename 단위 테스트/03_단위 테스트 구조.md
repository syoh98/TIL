## ✅ 3.1 단위 테스트를 구성하는 방법
* **AAA 패턴 사용**
  * 각 테스트를 준비, 실행, 검증이라는 세 부분으로 나눌 수 있다.
  * Given-When-Then 패턴에 차이는 없다. 프로그래머가 아닌 사람에게 이 구조가 더 읽기 쉽다.
* **여러 개의 준비, 실행, 검증 구절 피하기**
  * 보통 [테스트 준비] -> [실행] -> [검증] -> [좀 더 실행] -> [다시 검증] 과 같이 나타난다.
  * 실행이 하나면 테스트가 단위 테스트 범주에 있게끔 보장하고, 간단하고, 빠르며, 이해하기 쉽다. 일련의 실행과 검증이 포함된 테스트를 보면 리팩터링하라. 각 동작을 고유의 테스트로 도출하라.
* **테스트 내 if 문 피하기**
  * if문이 있는 단위 테스트는 안티패턴이다.
  * if문은 테스트가 한 번에 너무 많은 것을 검증한다는 표시다. 그러므로 이러한 테스트는 반드시 여러 테스트로 나눠야 한다.
* **각 구절은 얼마나 커야 하는가?**
  * 준비 구절이 가장 큰 경우: 훨씬 커지면 같은 테스트 클래스 내 비공개 메서드 또는 별도의 팩토리 클래스로 도출하는 것이 좋다.
  * 실행 구절이 한 줄 이상인 경우를 경계하라.: 실행 구절이 두 줄 이상인 경우 SUT의 공개 API에 문제가 있을 수 있다.
  * 불변 위반을 발생시키지 않기 위해 코드 캡슐화를 항상 지키자.
* **검증 구절에는 검증문이 얼마나 있어야 하는가**
  * 단위 테스트의 단위는 동작의 단위이고, 단일 동작 단위는 여러 결과를 낼 수 있다. 하지만 검증 구절이 너무 커지는 것은 경계해야 한다.
* **종료 단계는 어떤가**
  * 준비, 실행, 검증 이후의 네 번째 구절로 종료 구절을 따로 구분하기도 한다. 예를들면 테스트에 의해 작성된 파일을 지우거나 데이터베이스 연결을 종료하고자 이 구절을 사용할 수 있다.
* **테스트 대상 시스템 구별하기**
  * 동작은 여러 클래스에 걸쳐 있을 만큼 클 수도 있고 단일 메서드로 작을 수도 있다. 그러나 진입점은 오직 하나만 존재할 수 있다.
  * 따라서 SUT를 의존성과 구분하는 것이 중요하다.
* **준비, 실행, 검증 주석 제거하기**
  * 의존성에서 SUT를 떼어내는 것이 중요하듯이, 테스트 내에서 특정 부분이 어떤 구절에 속해 있는지 파악하는 데 시간을 많이 들이지 않도록 세 구절을 서로 구분하는 것 역시 중요하다.
  * 이를 위해 주석을 달자.
## ✅ 3.2 xUnit 테스트 프레임워크 살펴보기

## ✅ 3.3 테스트 간 테스트 픽스처 재사용
* ✏️ 테스트 픽스처: 테스트 픽스처는 테스트 실행 대상 객체다. 이 객체는 정규 의존성, 즉 SUT로 전달되는 인수다.
  * 테스트 픽스처를 재사용하는 첫 번째 방법은 테스트 생성자에서 테스트 픽스처를 초기화 하는 것이다. 그러나 이 기법은 두 가지 단점이 있다.
    * 테스트 간 결합도가 높아진다.
    * 테스트 가독성이 떨어진다.
* **테스트 간의 높은 결합도는 안티 패턴이다**
  * 테스트를 수정해도 다른 테스트에 영향을 주어서는 안된다.
  * 테스트 클래스에 공유 상태를 두지 말아야 한다.
* **테스트 가독성을 떨어뜨리는 생성자 사용**
  * 테스트만 보고는 더 이상 전체 그림을 볼 수 없다. 테스트 메서드가 무엇을 하는지 이해하려면 클래스의 다른 부분도 봐야 한다.
* **더 나은 테스트 픽스처 재사용법**
  * 다른 방법은 예제와 같이 테스트 클래스에 비공개 팩토리 메서드를 두는 것이다
  * 공통 초기화 코드를 비공개 팩토리 메서드로 추출해 테스트 코드를 짧게 하면서, 동시에 테스트 진행 상황에 대한 전체 맥락을 유지할 수 있다. 게다가 비공개 메서드를 충분히 일반화하는 한 테스트가 서로 결합되지 않는다.
## ✅ 3.4 단위 테스트 명명법
* **단위 테스트 명명 지침**
  * [테스트 대상 메서드]_ [시나리오]_[예상결과]: 이 관습은 동작 대신 구현 세부 사항에 집중하게끔 부추기기 때문에 분명히 도움이 되지 않는다.
  * 테스트가 정확히 무엇을 검증하는지, 비즈니스 요구 사항과 어떤 관련이 있는지 파악하려면 머리를 더 써야 한다. 별 것 아닌 것처럼 보일지도 모르지만, 시간이 지날수록 정신적으로 부담이 가중되며, 전체 테스트 스위트의 유지비가 천천히 늘어난다.
  * 표현력 있고 읽기 쉬운 테스트 이름을 지으려면 다음과 같은 지침을 따르자.
    * 엄격한 명명 정책을 따르지 않는다. 복잡한 동작에 대한 높은 수준의 설명을 이러한 정책의 좁은 상자 안에 넣을 수 없다. 표현의 자유를 허용하자.
    * 문제 도메인에 익숙한 비개발자들에게 시나리오를 설명하는 것처럼 테스트 이름을 짓자. 도메인 전문가나 비즈니스 분석가가 좋은 예다.
    * 단어를 밑줄(_) 표시로 구분한다. 그러면 특히 긴 이름에서 가독성을 향상시키는 데 도움이 된다.
* **예제: 지침에 따른 테스트 이름 변경**

## ✅ 3.5 매개변수화된 테스트 리팩터링하기
* **매개변수화된 테스트를 위한 데이터 생성**

## ✅ 3.6 검증문 라이브러리를 사용한 테스트 가독성 향상
* 테스트 가독성을 높이기 위한 방법 중, 검증문 라이브러리를 사용하는 것을 들 수 있다.
* Fluent Assertions 라이브러리는 숫자, 문자열, 컬렉션, 날짜 및 시간 등에 대해 검증할 수 있는 수많은 헬퍼 메서드를 제공한다. 유일한 단점은 프로젝트에 의존성을 추가해야 한다는 것이다.

## ✅ 요약
* 모든 단위 테스트는 AAA패턴(주비, 실행, 검증)을 따라야 한다.
* 실행 구절이 한 줄 이상이면 SUT의 API에 문제가 있다는 뜻이다.
* SUT의 이름을 sut로 지정해 SUT를 테스트에서 구별하자.
* 테스트 픽스처 초기화 코드는 생성자에 두지 말고 팩토리 메서드를 도입해서 재사용하자.
* 엄격한 테스트 명명 정책을 시행하지 말라.
* 매개변수화된 테스트로 유사한 테스트에 필요한 코드의 양을 줄일 수 있다.
* 검증문 라이브러리를 사용하면, 쉬운 영어처럼 읽도록 검증문에서 단어 순서를 재구성해 테스트 가독성을 더욱 향상시킬 수 있다.
