## 🌱7.1 SQL과 DAO의 분리
SQL을 DAO에서 분리해보자.
### 💡 XML 설정을 이용한 분리
* **개별 SQL 프로퍼티 방식**
  * 설정파일에 넣은 SQL 문장
  ```
  <bean id="userDao" class="springbook.user.dao.UserDaoJdbc">
    <property name="dataSource" ref="dataSource"/>
    <property name="sqlAdd" value="insert into users(id, name, password, email, level, login, recommend) values(?, ?, ?, ?, ?, ?, ?)"/>
    ...
  ```
  * 메서드에서 SQL 문장을 제거하고 외부로부터 DI 받은 sqlAdd를 사용하게 만든다.
  * 이런방식으로 변경하면 코드 수정없이 XML 설정을 바꾸는 것만으로도 자유롭게 수정이 가능하다
  * 하지만, 이 방법은 조금 불편하다. 매번 새로운 SQL이 필요할 때마다 프로퍼티를 추가하고 DI를 위한 변수와 수정자 메서드를 만들어줘야 하기 때문이다.
* **SQL 맵 프로퍼티 방식**
  * SQL을 하나의 컬렉션으로 담아두는 방법을 시도하자. 맵을 이용하면 프로퍼티는 하나만 만들어도 되기 때문에 DAO의 코드는 더 간결해진다.
  * 설정파일에 넣은 SQL 문장
    ```
    <bean id="userDao" class="springbook.user.dao.UserDaoJdbc">
      <property name="dataSource" ref="dataSource"/>
      <property name="sqlMap">
        <map>
          <entry key="add" value="insert into users(id, name, password, email, level, login, recommend) values(?, ?, ?, ?, ?, ?, ?)" />
          <entry key="get" value="select * from users where id = ?" />
          ...
        </map>
       </property>
    </bean>
    ```
### 💡 SQL 제공 서비스
위 코드에서는 몇 가지 문제점이 존재한다.
1. SQL과 DI 설정정보가 섞여 있으면 보기에도 지저분하고 관리하기에도 좋지 않다.
2. SQL을 꼭 스프링의 빈 설정 방법을 사용해 XML에 담아둘 이유도 없다.
3. 스프링의 설정파일로부터 생성된 오브젝트와 정보는 애플리케이션을 다시 시작하기 전에는 변경이 매우 어렵다.(운영 중인 애플리케이션에서 빈번하게 참조되는 맵 내용을 수정할 경우 동시성 문제를 일으킬 수도 있다.)
* **SQL 서비스 인터페이스**
  * DAO가 적절한 키를 제공해주고 그에 대한 SQL을 돌려받기만 하면 되도록 만들어주자.
  * sqlService를 사용하도록 수정한 메서드
    ```
    public void add(User user) {
      this.jdbcTemplate.update(this.sqlService.getSql("userAdd"),
           user.getId(), user.getName() ... );
    }
    // ...
    ```
* **스프링 설정을 사용하는 단순 SQL 서비스**
  * 맵을 이용한 SqlService의 구현
    ```
    public class SimpleService implments SqlService {
      private Map<String, String> sqlMap; // 설정파일에 <map>으로 정의된 SQL 정보를 가져오도록 프로퍼티로 등록해둔다.

      public void SqlMap(Map<String, String> sqlMap) {
        this.sqlMap = sqlMap;
      }
    }
    ```
  * 이제 UserDao를 포함한 모든 DAO는 SQL을 어디에 저장해두고 가져오는지에 대해서는 전혀 신경쓰지 않아도 된다.
  * 동시에 sqlService 빈에는 DAO에는 전혀 영향을 주지 않은 채로 다양한 방법으로 구현된 SqlService 타입 클래스를 적용할 수 있다.
</br>

## 🌱7.2 인터페이스의 분리와 자기참조 빈
</br>

## 🌱7.3 서비스 추상화 적용
</br>

## 🌱7.4 인터페이스 상속을 통한 안전한 기능확장
</br>

## 🌱7.5 DI를 이용해 다양한 구현 방법 적용하기
</br>

## 🌱7.6 스프링 3.1의 DI
</br>

## 🌱7.7 정리
